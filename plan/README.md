# plan

質問で要件を深掘りしてからプランニングする Claude Code プラグイン。

## 概要

曖昧な要件から始まるタスクに対して、`AskUserQuestion` ツールを使って対話的に要件を明確化し、Plan エージェントで実装計画を立案します。

## 用語の定義

このプラグインでは以下の用語を区別して使用します。

### Plan エージェント（このプラグインで使用）

- **起動方法**: Task ツールで `subagent_type: "Plan"` を指定
- **目的**: コードベースを調査し、実装計画を立案する
- **出力**: テキストとして返却（ファイル保存なし）
- **用途**: 自動的な計画立案

### Plan モード（このプラグインでは不使用）

- **起動方法**: `Shift+Tab` / `EnterPlanMode` / `--permission-mode plan`
- **目的**: ユーザー主導で計画を策定・承認する
- **出力**: `~/.claude/plans/` に自動保存
- **用途**: 対話的な計画策定・承認フロー

### 比較表

| 項目 | Plan エージェント | Plan モード |
|------|------------------|-------------|
| 起動方法 | Task ツール | `Shift+Tab` / `EnterPlanMode` |
| ファイル保存 | なし | `~/.claude/plans/` に自動保存 |
| 主な用途 | コードベース調査・計画立案 | ユーザー主導の計画策定・承認 |

## 機能

- **対話的な要件明確化**: 3-5問程度の質問で目的・スコープ・技術方針・優先順位を深掘り
- **合意確認**: 整理した要件を構造化して提示し、認識のズレを防止
- **Plan エージェントによる計画立案**: コードベースを調査し、実装計画を自動生成
- **3つの出力形式**:
  - そのまま実装開始
  - ファイル保存（`tmp/{plan_name}.md`）
  - チャットで説明（ファイル出力なし）
- **情報収集**: 必要に応じて Web 検索や既存コードの確認が可能

## 使い方

```bash
# 相談内容を引数で指定
/plan:digging ログイン機能を追加したい

# 引数なしで実行（対話的に相談内容を聞く）
/plan:digging
```

## 実行フロー

```
/plan:digging
    ↓
1. 初期化：相談内容を聞く
    ↓
2. 質問フェーズ：AskUserQuestion で要件明確化
    ↓
3. 合意確認：整理した要件を確認
    ↓
4. Plan エージェント：計画立案（コードベース調査含む）
    ↓
5. 出力形式選択：実装開始 / ファイル保存 / チャット説明
    ↓
6. 出力：選択に応じた処理
    ↓
7. 完了：次のステップを提案
```

## インストール

### マーケットプレイス経由（推奨）

```bash
# マーケットプレイスを登録
/plugin marketplace add chippy-ao/claude-code

# プラグインをインストール
/plugin install plan@chippy-ao-plugins
```

### ローカルディレクトリ指定

```bash
claude --plugin-dir /path/to/plan
```

## ライセンス

MIT